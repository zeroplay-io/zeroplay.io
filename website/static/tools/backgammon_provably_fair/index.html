<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Provably Fair Backgammon Dice Verifier</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Provably Fair Backgammon Dice Verifier"
    />
    <meta
      property="og:description"
      content="I've verified the fairness of my backgammon game. All dice rolls were cryptographically proven to be fair!"
    />
    <meta
      property="og:image"
      content="https://zeroplay.io/games/backgammon/banner.png"
    />
    <style>
      :root {
        --bg: #ffffff;
        --panel: #f8fafc;
        --card: #ffffff;
        --txt: #1e293b;
        --txt-muted: #64748b;
        --accent: #10b981;
        --accent-light: #d1fae5;
        --err: #ef4444;
        --err-light: #fee2e2;
        --warning: #f59e0b;
        --info: #3b82f6;
        --border: #e2e8f0;
        --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      * {
        box-sizing: border-box;
        font-family: var(--font);
        margin: 0;
        padding: 0;
      }

      body {
        background: var(--bg);
        color: var(--txt);
        line-height: 1.6;
        min-height: 100vh;
        padding: 20px;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 32px;
      }

      .title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--txt);
        margin-bottom: 8px;
      }

      .subtitle {
        color: var(--txt-muted);
        font-size: 1.1rem;
      }

      .card {
        background: var(--card);
        border-radius: 12px;
        padding: 24px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        margin-bottom: 24px;
      }

      .input-section {
        margin-bottom: 24px;
      }

      .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .upload-methods {
        margin-top: 16px;
      }

      .method-tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border);
      }

      .method-tab {
        padding: 12px 20px;
        font-size: 0.95rem;
        font-weight: 500;
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
        color: var(--txt-muted);
      }

      .method-tab:hover {
        color: var(--txt);
        background: var(--panel);
      }

      .method-tab.active {
        color: var(--accent);
        border-bottom-color: var(--accent);
        background: var(--accent-light);
      }

      .method-content {
        transition: opacity 0.3s ease;
      }

      .method-content.hidden {
        display: none;
      }

      .paste-area {
        text-align: center;
        padding: 24px;
        border: 2px dashed var(--border);
        border-radius: 8px;
        background: var(--panel);
      }

      .paste-icon {
        font-size: 2.5rem;
        margin-bottom: 12px;
        opacity: 0.7;
      }

      .paste-text {
        font-size: 1.1rem;
        color: var(--txt-muted);
        margin-bottom: 16px;
      }

      #pasteInput {
        width: 100%;
        min-height: 120px;
        background: white;
        border: 1px solid var(--border);
        color: var(--txt);
        font: 13px/1.4 monospace;
        padding: 12px;
        border-radius: 6px;
        resize: vertical;
        margin-bottom: 12px;
      }

      #pasteInput:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px var(--accent-light);
      }

      .upload-area {
        border: 2px dashed var(--border);
        border-radius: 8px;
        padding: 32px;
        text-align: center;
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
        outline: none;
      }

      .upload-area:hover,
      .upload-area:focus {
        border-color: var(--accent);
        background: var(--accent-light);
      }

      .upload-area.dragover {
        border-color: var(--accent);
        background: var(--accent-light);
        transform: scale(1.02);
      }

      .upload-icon {
        font-size: 3rem;
        margin-bottom: 16px;
        opacity: 0.6;
      }

      .upload-text {
        font-size: 1.1rem;
        color: var(--txt-muted);
        margin-bottom: 8px;
      }

      .upload-hint {
        font-size: 0.9rem;
        color: var(--txt-muted);
      }

      .hidden-textarea {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .controls {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 16px;
      }

      .btn {
        padding: 12px 24px;
        font-size: 1rem;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--accent);
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #059669;
        transform: translateY(-1px);
        box-shadow: var(--shadow-lg);
      }

      .btn-secondary {
        background: var(--panel);
        color: var(--txt);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover:not(:disabled) {
        background: #f1f5f9;
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
      }

      .verification-steps {
        display: none;
      }

      .verification-steps.show {
        display: block;
      }

      .step {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        padding: 16px 0;
        border-bottom: 1px solid var(--border);
        opacity: 0.3;
        transform: translateX(-10px);
        transition: all 0.3s ease;
      }

      .step:last-child {
        border-bottom: none;
      }

      .step.active {
        opacity: 1;
        transform: translateX(0);
      }

      .step.completed {
        opacity: 1;
        transform: translateX(0);
      }

      .step-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        flex-shrink: 0;
        transition: all 0.3s;
      }

      .step.pending .step-icon {
        background: var(--border);
        color: var(--txt-muted);
      }

      .step.active .step-icon {
        background: var(--info);
        color: white;
        animation: pulse 2s infinite;
      }

      .step.completed .step-icon {
        background: var(--accent);
        color: white;
      }

      .step.error .step-icon {
        background: var(--err);
        color: white;
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-weight: 600;
        margin-bottom: 4px;
      }

      .step-description {
        color: var(--txt-muted);
        font-size: 0.9rem;
        margin-bottom: 8px;
      }

      .step-details {
        background: var(--panel);
        border-radius: 6px;
        padding: 12px;
        margin-top: 8px;
        font-family: "Monaco", "Menlo", monospace;
        font-size: 0.85rem;
        display: none;
      }

      .step-details.show {
        display: block;
      }

      .step-details .label {
        color: var(--txt-muted);
        margin-right: 8px;
      }

      .step-details .value {
        color: var(--txt);
        word-break: break-all;
      }

      .dice-comparison {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 8px;
      }

      .dice-roll {
        background: var(--panel);
        padding: 8px 12px;
        border-radius: 6px;
        text-align: center;
        font-weight: 600;
      }

      .dice-roll.match {
        background: var(--accent-light);
        color: var(--accent);
      }

      .dice-roll.mismatch {
        background: var(--err-light);
        color: var(--err);
      }

      .rolls-container {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: white;
      }

      .roll-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        border-bottom: 1px solid var(--border);
        transition: all 0.2s;
        opacity: 0.4;
      }

      .roll-item:last-child {
        border-bottom: none;
      }

      .roll-item.verifying {
        background: #fff7ed;
        opacity: 1;
        transform: scale(1.02);
        box-shadow: 0 2px 8px rgba(251, 146, 60, 0.1);
      }

      .roll-item.verified {
        background: var(--accent-light);
        opacity: 1;
      }

      .roll-item.failed {
        background: var(--err-light);
        opacity: 1;
      }

      .roll-number {
        width: 40px;
        font-weight: 600;
        color: var(--txt-muted);
        font-size: 0.9rem;
      }

      .roll-dice {
        display: flex;
        gap: 8px;
        flex: 1;
      }

      .die {
        width: 32px;
        height: 32px;
        background: white;
        border: 2px solid var(--border);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.1rem;
      }

      .die.match {
        border-color: var(--accent);
        background: var(--accent-light);
        color: var(--accent);
      }

      .die.mismatch {
        border-color: var(--err);
        background: var(--err-light);
        color: var(--err);
      }

      .vs-label {
        margin: 0 12px;
        color: var(--txt-muted);
        font-size: 0.9rem;
      }

      .roll-status {
        width: 80px;
        text-align: center;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .roll-status.verifying {
        color: var(--warning);
      }

      .roll-status.verified {
        color: var(--accent);
      }

      .roll-status.failed {
        color: var(--err);
      }

      .rolls-summary {
        padding: 12px 16px;
        background: var(--panel);
        border-radius: 6px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .summary-text {
        font-weight: 600;
        color: var(--txt);
      }

      .summary-progress {
        color: var(--txt-muted);
        font-size: 0.9rem;
      }

      .collapsible {
        margin-top: 24px;
      }

      .collapsible-header {
        display: flex;
        align-items: center;
        justify-content: between;
        gap: 8px;
        cursor: pointer;
        padding: 12px;
        background: var(--panel);
        border-radius: 8px;
        transition: all 0.2s;
      }

      .collapsible-header:hover {
        background: #f1f5f9;
      }

      .collapsible-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .collapsible-content.open {
        max-height: 400px;
      }

      .raw-report {
        background: #1e293b;
        color: #e2e8f0;
        font-family: "Monaco", "Menlo", monospace;
        font-size: 0.8rem;
        padding: 16px;
        border-radius: 8px;
        margin-top: 12px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        border: 1px solid var(--border);
      }

      .final-result {
        display: none;
        text-align: center;
        padding: 32px;
        margin-top: 24px;
      }

      .final-result.show {
        display: block;
      }

      .result-icon {
        font-size: 4rem;
        margin-bottom: 16px;
      }

      .result-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .result-description {
        color: var(--txt-muted);
        font-size: 1.1rem;
      }

      .success .result-icon {
        color: var(--accent);
        animation: successBounce 0.6s ease;
      }

      .success .result-title {
        color: var(--accent);
      }

      .error .result-icon {
        color: var(--err);
      }

      .error .result-title {
        color: var(--err);
      }

      .action-buttons {
        display: flex;
        gap: 16px;
        justify-content: center;
        margin-top: 32px;
      }

      .btn-action {
        position: relative;
        padding: 16px 32px;
        font-size: 0.95rem;
        font-weight: 600;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        min-width: 140px;
        text-decoration: none;
        overflow: hidden;
      }

      .btn-action::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0) 100%
        );
        opacity: 0;
        transition: opacity 0.3s;
      }

      .btn-action:hover::before {
        opacity: 1;
      }

      .btn-action-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        transition: transform 0.3s;
      }

      .btn-action:hover .btn-action-icon {
        transform: scale(1.1);
      }

      .btn-action-text {
        font-size: 0.9rem;
        letter-spacing: 0.025em;
      }

      .btn-game {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.3);
      }

      .btn-game:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px 0 rgba(59, 130, 246, 0.4);
      }

      .btn-game:active {
        transform: translateY(-1px);
      }

      .btn-share {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.3);
      }

      .btn-share:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px 0 rgba(16, 185, 129, 0.4);
      }

      .btn-share:active {
        transform: translateY(-1px);
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
      }

      .modal-overlay.show {
        display: flex;
      }

      .modal {
        background: white;
        border-radius: 12px;
        padding: 20px;
        max-width: 320px;
        width: 100%;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .modal-header {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 16px;
        text-align: center;
      }

      .modal-close {
        position: absolute;
        top: 12px;
        right: 12px;
        background: none;
        border: none;
        font-size: 1.25rem;
        cursor: pointer;
        color: var(--txt-muted);
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s;
      }

      .modal-close:hover {
        background: var(--panel);
        color: var(--txt);
      }

      .share-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 16px;
      }

      .share-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 12px 6px;
        border: 1px solid var(--border);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        color: var(--txt);
      }

      .share-option:hover {
        background: var(--panel);
        transform: translateY(-2px);
        box-shadow: var(--shadow);
      }

      .share-icon {
        width: 32px;
        height: 32px;
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .share-icon svg {
        width: 100%;
        height: 100%;
      }

      .share-label {
        font-size: 0.85rem;
      }

      .floating-btn {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--accent);
        color: white;
        border: none;
        box-shadow: var(--shadow-lg);
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        transition: all 0.2s;
        z-index: 100;
      }

      .floating-btn.show {
        display: flex;
      }

      .floating-btn:hover {
        transform: scale(1.1);
        background: #059669;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      @keyframes successBounce {
        0% {
          transform: scale(0.3);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      .progress-bar {
        width: 100%;
        height: 4px;
        background: var(--border);
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 24px;
        display: none;
      }

      .progress-bar.show {
        display: block;
      }

      .progress-fill {
        height: 100%;
        background: var(--accent);
        width: 0%;
        transition: width 0.3s ease;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-top: 16px;
      }

      .stat {
        text-align: center;
        padding: 16px;
        background: var(--panel);
        border-radius: 8px;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent);
      }

      .stat-label {
        color: var(--txt-muted);
        font-size: 0.9rem;
      }

      footer {
        text-align: center;
        margin-top: 48px;
        padding: 24px 16px 40px;
        border-top: 1px solid var(--border);
        color: var(--txt-muted);
        font-size: 0.9rem;
      }

      footer a {
        color: var(--accent);
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        body {
          padding: 16px;
          padding-bottom: 32px;
        }

        .container {
          padding: 0;
        }

        .card {
          padding: 16px;
        }

        .controls {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }

        .action-buttons {
          flex-direction: row;
          gap: 12px;
        }

        .btn-action {
          min-width: 0;
          flex: 1;
          padding: 12px 16px;
        }

        .btn-action-icon {
          width: 28px;
          height: 28px;
          font-size: 1.3rem;
        }

        .btn-action-text {
          font-size: 0.85rem;
        }

        .share-options {
          grid-template-columns: repeat(2, 1fr);
        }

        footer {
          padding-bottom: 60px;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1 class="title">üé≤ Fairness Verifier</h1>
        <p class="subtitle">
          Step-by-step verification of provably fair dice rolls
        </p>
      </div>

      <div class="card input-section">
        <h2 class="section-title">üìÅ Upload Report</h2>

        <div class="upload-methods">
          <div class="method-tabs">
            <button class="method-tab active" id="fileTab">
              üìÅ File Upload
            </button>
            <button class="method-tab" id="pasteTab">üìã Paste JSON</button>
          </div>

          <div class="method-content" id="fileMethod">
            <div class="upload-area" id="uploadArea">
              <div class="upload-icon">üìÑ</div>
              <div class="upload-text">
                Drop your report file here or click to select
              </div>
              <div class="upload-hint">
                Supports JSON format from game server
              </div>
            </div>
          </div>

          <div class="method-content hidden" id="pasteMethod">
            <div class="paste-area">
              <div class="paste-icon">üìã</div>
              <div class="paste-text">Paste your JSON report below</div>
              <textarea
                id="pasteInput"
                placeholder="Paste JSON report here..."
                spellcheck="false"
                autocorrect="off"
                autocomplete="off"
              ></textarea>
              <button class="btn btn-secondary" id="pasteBtn">
                <span>üìã</span>
                Load from Clipboard
              </button>
            </div>
          </div>
        </div>

        <textarea
          id="input"
          class="hidden-textarea"
          spellcheck="false"
          autocorrect="off"
          autocomplete="off"
        ></textarea>

        <div class="controls">
          <button class="btn btn-primary" id="verifyBtn" disabled>
            <span>üîç</span>
            Start Verification
          </button>
          <button class="btn btn-secondary" id="clearBtn">
            <span>üóëÔ∏è</span>
            Clear
          </button>
        </div>
      </div>

      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="card verification-steps" id="verificationSteps">
        <h2 class="section-title">üîÑ Verification Process</h2>

        <div class="step pending" id="step1">
          <div class="step-icon">1</div>
          <div class="step-content">
            <div class="step-title">Parse Report Data</div>
            <div class="step-description">
              Reading and validating JSON structure
            </div>
            <div class="step-details" id="step1Details"></div>
          </div>
        </div>

        <div class="step pending" id="step2">
          <div class="step-icon">2</div>
          <div class="step-content">
            <div class="step-title">Verify Server Seed Hash</div>
            <div class="step-description">
              Confirming server seed matches its SHA-256 hash
            </div>
            <div class="step-details" id="step2Details"></div>
          </div>
        </div>

        <div class="step pending" id="step3">
          <div class="step-icon">3</div>
          <div class="step-content">
            <div class="step-title">Generate Combined Seed</div>
            <div class="step-description">
              Mixing client seeds deterministically
            </div>
            <div class="step-details" id="step3Details"></div>
          </div>
        </div>

        <div class="step pending" id="step4">
          <div class="step-icon">4</div>
          <div class="step-content">
            <div class="step-title">Verify Dice Rolls</div>
            <div class="step-description">
              Reproducing and comparing each dice roll using HMAC-SHA256
            </div>
            <div class="step-details" id="step4Details">
              <div id="rollsContainer"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="final-result" id="finalResult">
        <div class="result-icon">‚úÖ</div>
        <div class="result-title">Verification Complete</div>
        <div class="result-description">
          All dice rolls have been successfully verified
        </div>
        <div class="stats" id="verificationStats"></div>
      </div>

      <div class="card collapsible" id="rawReportSection" style="display: none">
        <div class="collapsible-header" id="rawReportToggle">
          <span>üìã Raw Report Data</span>
          <span style="margin-left: auto">‚ñº</span>
        </div>
        <div class="collapsible-content" id="rawReportContent">
          <div class="raw-report" id="rawReport"></div>
        </div>
      </div>

      <footer>
        Offline Running ¬∑ Provably Fair ¬∑
        <a
          href="https://github.com/zeroplay-io/backgammon_provably_fair"
          target="_blank"
          rel="noopener"
        >
          <strong>Open Source</strong>
        </a>
      </footer>
    </div>

    <!-- Floating button to reopen results -->
    <button
      class="floating-btn"
      id="floatingBtn"
      title="Show Verification Results"
    >
      üéØ
    </button>

    <!-- Share modal -->
    <div class="modal-overlay" id="shareModal">
      <div class="modal">
        <button class="modal-close" id="closeShareModal">&times;</button>
        <div class="modal-header">Share Verification</div>
        <div class="share-options" id="shareOptions">
          <a href="#" class="share-option" data-platform="twitter">
            <div class="share-icon">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
                />
              </svg>
            </div>
            <div class="share-label">Twitter</div>
          </a>
          <a href="#" class="share-option" data-platform="facebook">
            <div class="share-icon">
              <svg viewBox="0 0 24 24" fill="#1877F2">
                <path
                  d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
                />
              </svg>
            </div>
            <div class="share-label">Facebook</div>
          </a>
          <a href="#" class="share-option" data-platform="whatsapp">
            <div class="share-icon">
              <svg viewBox="0 0 24 24" fill="#25D366">
                <path
                  d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"
                />
              </svg>
            </div>
            <div class="share-label">WhatsApp</div>
          </a>
          <a href="#" class="share-option" data-platform="telegram">
            <div class="share-icon">
              <svg viewBox="0 0 24 24" fill="#229ED9">
                <path
                  d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"
                />
              </svg>
            </div>
            <div class="share-label">Telegram</div>
          </a>
          <a href="#" class="share-option" data-platform="reddit">
            <div class="share-icon">
              <svg viewBox="0 0 24 24" fill="#FF4500">
                <path
                  d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"
                />
              </svg>
            </div>
            <div class="share-label">Reddit</div>
          </a>
          <a href="#" class="share-option" data-platform="copy">
            <div class="share-icon">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"
                />
              </svg>
            </div>
            <div class="share-label">Copy Link</div>
          </a>
        </div>
      </div>
    </div>

    <script src="wasm_exec.js"></script>
    <script>
      const go = new Go();
      let wasmReady = false;
      let currentGameId = null;
      let currentReport = null;

      WebAssembly.instantiateStreaming(
        fetch("verifier.wasm"),
        go.importObject
      ).then((r) => {
        go.run(r.instance);
        wasmReady = true;
        maybeAutoVerify();
      });

      const $ = (id) => document.getElementById(id);

      // UI Elements
      const uploadArea = $("uploadArea");
      const input = $("input");
      const pasteInput = $("pasteInput");
      const verifyBtn = $("verifyBtn");
      const clearBtn = $("clearBtn");
      const pasteBtn = $("pasteBtn");
      const fileTab = $("fileTab");
      const pasteTab = $("pasteTab");
      const fileMethod = $("fileMethod");
      const pasteMethod = $("pasteMethod");
      const verificationSteps = $("verificationSteps");
      const progressBar = $("progressBar");
      const progressFill = $("progressFill");
      const finalResult = $("finalResult");
      const rawReportSection = $("rawReportSection");
      const rawReportToggle = $("rawReportToggle");
      const rawReportContent = $("rawReportContent");
      const floatingBtn = $("floatingBtn");
      const shareModal = $("shareModal");
      const closeShareModal = $("closeShareModal");

      // Tab switching
      fileTab.addEventListener("click", () => {
        fileTab.classList.add("active");
        pasteTab.classList.remove("active");
        fileMethod.classList.remove("hidden");
        pasteMethod.classList.add("hidden");
      });

      pasteTab.addEventListener("click", () => {
        pasteTab.classList.add("active");
        fileTab.classList.remove("active");
        fileMethod.classList.add("hidden");
        pasteMethod.classList.remove("hidden");
        pasteInput.focus();
      });

      // Paste input handling
      pasteInput.addEventListener("input", () => {
        const content = pasteInput.value.trim();
        if (content) {
          try {
            JSON.parse(content); // Validate JSON
            input.value = content;
            verifyBtn.disabled = false;
            updateUploadStatus("JSON content loaded successfully", true);
          } catch (e) {
            verifyBtn.disabled = true;
            updateUploadStatus("Invalid JSON format", false);
          }
        } else {
          verifyBtn.disabled = true;
          updateUploadStatus("", false);
        }
      });

      // Paste from clipboard button
      pasteBtn.addEventListener("click", async () => {
        try {
          const text = await navigator.clipboard.readText();
          pasteInput.value = text;
          pasteInput.dispatchEvent(new Event("input"));
        } catch (err) {
          alert("Unable to read from clipboard. Please paste manually.");
        }
      });

      function updateUploadStatus(message, isSuccess) {
        if (isSuccess) {
          if (fileTab.classList.contains("active")) {
            uploadArea.innerHTML = `
						<div class="upload-icon">‚úÖ</div>
						<div class="upload-text">${message}</div>
						<div class="upload-hint">Ready for verification</div>
					`;
          }
        }
      }

      // Event Listeners
      uploadArea.addEventListener("click", () => {
        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = ".json,.txt";
        fileInput.onchange = (e) => {
          if (e.target.files[0]) {
            e.target.files[0].text().then(handleFileContent);
          }
        };
        fileInput.click();
      });

      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("dragover");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        if (e.dataTransfer.files.length) {
          e.dataTransfer.files[0].text().then(handleFileContent);
        }
      });

      verifyBtn.addEventListener("click", startVerification);
      clearBtn.addEventListener("click", clearAll);

      rawReportToggle.addEventListener("click", () => {
        const content = rawReportContent;
        const isOpen = content.classList.contains("open");
        content.classList.toggle("open");
        rawReportToggle.querySelector("span:last-child").textContent = isOpen
          ? "‚ñº"
          : "‚ñ≤";
      });

      // Floating button
      floatingBtn.addEventListener("click", () => {
        if (currentGameId) {
          showSuccessWithActions(currentReport.rolls.length / 2);
        }
      });

      // Share modal
      closeShareModal.addEventListener("click", () => {
        shareModal.classList.remove("show");
      });

      shareModal.addEventListener("click", (e) => {
        if (e.target === shareModal) {
          shareModal.classList.remove("show");
        }
      });

      // Share options
      document.querySelectorAll(".share-option").forEach((option) => {
        option.addEventListener("click", (e) => {
          e.preventDefault();
          const platform = option.getAttribute("data-platform");
          handleShare(platform);
        });
      });

      function handleFileContent(content) {
        input.value = content;
        updateUploadStatus("Report loaded successfully", true);
        verifyBtn.disabled = false;

        // If we're on paste tab, also update the textarea
        if (pasteTab.classList.contains("active")) {
          pasteInput.value = content;
        }
      }

      function clearAll() {
        input.value = "";
        pasteInput.value = "";
        currentGameId = null;
        currentReport = null;
        uploadArea.innerHTML = `
				<div class="upload-icon">üìÑ</div>
				<div class="upload-text">Drop your report file here or click to select</div>
				<div class="upload-hint">Supports JSON format from game server</div>
			`;
        verifyBtn.disabled = true;
        verificationSteps.classList.remove("show");
        progressBar.classList.remove("show");
        finalResult.classList.remove("show");
        rawReportSection.style.display = "none";
        floatingBtn.classList.remove("show");
        resetSteps();
      }

      function resetSteps() {
        for (let i = 1; i <= 4; i++) {
          const step = $(`step${i}`);
          step.className = "step pending";
          const details = $(`step${i}Details`);
          details.classList.remove("show");
          details.innerHTML = "";
        }
      }

      function setStepState(stepNum, state, details = "") {
        const step = $(`step${stepNum}`);
        const stepIcon = step.querySelector(".step-icon");
        const stepDetails = $(`step${stepNum}Details`);

        step.className = `step ${state}`;

        if (state === "completed") {
          stepIcon.textContent = "‚úì";
        } else if (state === "error") {
          stepIcon.textContent = "‚úó";
        } else {
          stepIcon.textContent = stepNum.toString();
        }

        if (details) {
          stepDetails.innerHTML = details;
          stepDetails.classList.add("show");
        }

        // Auto-scroll to current step
        if (state === "active" || state === "completed") {
          setTimeout(() => {
            step.scrollIntoView({
              behavior: "smooth",
              block: "center",
              inline: "nearest",
            });
          }, 100);
        }
      }

      function updateProgress(percent) {
        progressFill.style.width = `${percent}%`;
      }

      async function startVerification() {
        if (!wasmReady) {
          alert("Verification engine is still loading. Please wait a moment.");
          return;
        }

        if (!input.value.trim()) {
          alert("Please upload a report file first.");
          return;
        }

        verifyBtn.disabled = true;
        verificationSteps.classList.add("show");
        progressBar.classList.add("show");
        finalResult.classList.remove("show");
        floatingBtn.classList.remove("show");
        resetSteps();

        try {
          const report = JSON.parse(input.value);
          currentReport = report;
          currentGameId = report.game_id;
          await simulateVerificationProcess(report);
        } catch (error) {
          showError("Invalid JSON format: " + error.message);
          verifyBtn.disabled = false;
        }
      }

      async function simulateVerificationProcess(report) {
        // Step 1: Parse Report Data
        setStepState(1, "active");
        updateProgress(10);
        await sleep(800);

        const step1Details = `
				<div><span class="label">Game ID:</span><span class="value">${
          report.game_id || "N/A"
        }</span></div>
				<div><span class="label">Players:</span><span class="value">${
          report.players?.length || 0
        }</span></div>
				<div><span class="label">Total Rolls:</span><span class="value">${
          report.rolls?.length / 2 || 0
        }</span></div>
			`;
        setStepState(1, "completed", step1Details);
        updateProgress(15);

        // Step 2: Verify Server Seed Hash
        await sleep(600);
        setStepState(2, "active");

        try {
          // Call the actual verification to get real results
          const verifyResult = verify(input.value);

          if (verifyResult !== "OK") {
            throw new Error(verifyResult);
          }

          await sleep(1000);
          const step2Details = `
					<div><span class="label">Server Seed:</span><span class="value">${
            report.server_seed || "N/A"
          }</span></div>
					<div><span class="label">Server Seed Hash:</span><span class="value">${
            report.server_seed_hash || "N/A"
          }</span></div>
					<div><span class="label">Hash Verification:</span><span class="value" style="color: var(--accent);">‚úÖ SHA-256 Match</span></div>
				`;
          setStepState(2, "completed", step2Details);
          updateProgress(25);

          // Step 3: Generate Combined Seed
          await sleep(600);
          setStepState(3, "active");

          // Calculate combined seed for display
          const combinedSeedResult = await calculateCombinedSeed(report);
          await sleep(1200);

          const step3Details = `
					<div><span class="label">Player A UID:</span><span class="value">${report.players[0]?.uid}</span></div>
					<div><span class="label">Player A Seed:</span><span class="value">${report.players[0]?.client_seed}</span></div>
					<div><span class="label">Player A Source:</span><span class="value">${report.players[0]?.source}</span></div>
					<div><span class="label">Player B UID:</span><span class="value">${report.players[1]?.uid}</span></div>
					<div><span class="label">Player B Seed:</span><span class="value">${report.players[1]?.client_seed}</span></div>
					<div><span class="label">Player B Source:</span><span class="value">${report.players[1]?.source}</span></div>
					<div><span class="label">Combined Seed:</span><span class="value">${combinedSeedResult}</span></div>
				`;
          setStepState(3, "completed", step3Details);
          updateProgress(35);

          // Step 4: Verify Dice Rolls
          await sleep(600);
          setStepState(4, "active");
          await simulateRollVerification(report);
        } catch (error) {
          setStepState(
            2,
            "error",
            `<div style="color: var(--err);">‚ùå ${error.message}</div>`
          );
          showError(error.message);
        }

        verifyBtn.disabled = false;
      }

      // Helper function to calculate combined seed for display
      async function calculateCombinedSeed(report) {
        try {
          const p1 = report.players[0];
          const p2 = report.players[1];

          const aUID = p1.uid.toString();
          const bUID = p2.uid.toString();
          const leftFirst = aUID < bUID;
          const header = leftFirst ? `${aUID}:${bUID}:` : `${bUID}:${aUID}:`;

          const first = aUID <= bUID ? p1.client_seed : p2.client_seed;
          const second = aUID <= bUID ? p2.client_seed : p1.client_seed;

          // Create the combined string for hashing
          const combined = header + first + ":" + second;

          // Calculate SHA-256 hash
          const encoder = new TextEncoder();
          const data = encoder.encode(combined);
          const hashBuffer = await crypto.subtle.digest("SHA-256", data);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          const hashHex = hashArray
            .map((b) => b.toString(16).padStart(2, "0"))
            .join("");

          return hashHex;
        } catch (error) {
          return "Error calculating combined seed";
        }
      }

      async function simulateRollVerification(report) {
        const rollCount = report.rolls.length / 2;
        const step4Details = $("step4Details");

        // Create rolls summary
        const summaryHTML = `
				<div class="rolls-summary">
					<span class="summary-text">Verifying ${rollCount} dice rolls...</span>
					<span class="summary-progress" id="rollProgress">0 / ${rollCount}</span>
				</div>
			`;

        // Create rolls container
        let rollsHTML = '<div class="rolls-container" id="rollsList">';

        // Generate all roll items
        for (let i = 0; i < rollCount; i++) {
          const expectedD1 = report.rolls[i * 2];
          const expectedD2 = report.rolls[i * 2 + 1];

          rollsHTML += `
					<div class="roll-item" id="roll-${i}">
						<div class="roll-number">#${i + 1}</div>
						<div class="roll-dice">
							<div class="die" id="die-${i}-1">${expectedD1}</div>
							<div class="die" id="die-${i}-2">${expectedD2}</div>
						</div>
						<div class="vs-label">vs</div>
						<div class="roll-dice">
							<div class="die" id="computed-${i}-1">?</div>
							<div class="die" id="computed-${i}-2">?</div>
						</div>
						<div class="roll-status" id="status-${i}">Pending</div>
					</div>
				`;
        }
        rollsHTML += "</div>";

        step4Details.innerHTML = summaryHTML + rollsHTML;
        step4Details.classList.add("show");

        // Simulate verification of each roll
        for (let i = 0; i < rollCount; i++) {
          const rollItem = $(`roll-${i}`);
          const die1 = $(`computed-${i}-1`);
          const die2 = $(`computed-${i}-2`);
          const status = $(`status-${i}`);
          const rollProgress = $("rollProgress");

          if (!rollItem || !die1 || !die2 || !status || !rollProgress) {
            console.error(`Missing elements for roll ${i}`);
            continue;
          }

          // Mark as verifying
          rollItem.classList.add("verifying");
          status.textContent = "Verifying";
          status.className = "roll-status verifying";

          // Auto-scroll to keep current verification visible
          rollItem.scrollIntoView({
            behavior: "smooth",
            block: "nearest",
            inline: "nearest",
          });

          // Simulate computation delay
          await sleep(150 + Math.random() * 200);

          // Get expected values
          const expectedD1 = parseInt(report.rolls[i * 2]);
          const expectedD2 = parseInt(report.rolls[i * 2 + 1]);

          // Show computed values (they should match since we already verified)
          die1.textContent = expectedD1;
          die2.textContent = expectedD2;

          // Mark as verified
          rollItem.classList.remove("verifying");
          rollItem.classList.add("verified");

          // Update dice appearance
          die1.classList.add("match");
          die2.classList.add("match");
          const expectedDie1 = $(`die-${i}-1`);
          const expectedDie2 = $(`die-${i}-2`);
          if (expectedDie1) expectedDie1.classList.add("match");
          if (expectedDie2) expectedDie2.classList.add("match");

          status.textContent = "‚úÖ Match";
          status.className = "roll-status verified";

          // Update progress
          rollProgress.textContent = `${i + 1} / ${rollCount}`;

          // Update overall progress
          const progress = 35 + (60 * (i + 1)) / rollCount;
          updateProgress(progress);
        }

        // Mark step as completed
        await sleep(500);
        const finalSummary = `
				<div><span class="label">Total Dice Rolls:</span><span class="value">${rollCount}</span></div>
				<div><span class="label">Verification Method:</span><span class="value">HMAC-SHA256 with rejection sampling</span></div>
				<div><span class="label">Status:</span><span class="value" style="color: var(--accent);">All rolls verified ‚úÖ</span></div>
			`;

        // Update the summary at the top
        const currentContent = step4Details.innerHTML;
        step4Details.innerHTML = finalSummary + currentContent;

        setStepState(4, "completed");
        updateProgress(100);

        // Show final success result
        await sleep(800);
        showSuccessWithActions(rollCount);
      }

      function showSuccessWithActions(rollCount) {
        finalResult.className = "final-result success show";
        finalResult.innerHTML = `
				<div class="result-icon">üéâ</div>
				<div class="result-title">Verification Successful!</div>
				<div class="result-description">All ${rollCount} dice rolls have been cryptographically verified</div>
				<div class="stats">
					<div class="stat">
						<div class="stat-value">${rollCount}</div>
						<div class="stat-label">Rolls Verified</div>
					</div>
					<div class="stat">
						<div class="stat-value">100%</div>
						<div class="stat-label">Fairness Score</div>
					</div>
					<div class="stat">
						<div class="stat-value">SHA-256</div>
						<div class="stat-label">Crypto Standard</div>
					</div>
				</div>
				<div class="action-buttons">
					<button class="btn-action btn-game" onclick="replayGame()">
						<div class="btn-action-icon">üéÆ</div>
						<div class="btn-action-text">Replay Game</div>
					</button>
					<button class="btn-action btn-share" onclick="shareVerification()">
						<div class="btn-action-icon">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<circle cx="18" cy="5" r="3"></circle>
								<circle cx="6" cy="12" r="3"></circle>
								<circle cx="18" cy="19" r="3"></circle>
								<line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
								<line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
							</svg>
						</div>
						<div class="btn-action-text">Share Result</div>
					</button>
				</div>
			`;

        // Show raw report section
        rawReportSection.style.display = "block";
        $("rawReport").textContent = JSON.stringify(
          JSON.parse(input.value),
          null,
          2
        );

        // Show floating button for future access
        floatingBtn.classList.add("show");

        // Auto-scroll to final result
        setTimeout(() => {
          finalResult.scrollIntoView({
            behavior: "smooth",
            block: "start",
            inline: "nearest",
          });
        }, 200);
      }

      function showError(message) {
        finalResult.className = "final-result error show";
        finalResult.innerHTML = `
				<div class="result-icon">‚ùå</div>
				<div class="result-title">Verification Failed</div>
				<div class="result-description">${message}</div>
			`;

        // Show raw report section for debugging
        rawReportSection.style.display = "block";
        $("rawReport").textContent = input.value;

        // Auto-scroll to final result
        setTimeout(() => {
          finalResult.scrollIntoView({
            behavior: "smooth",
            block: "center",
            inline: "nearest",
          });
        }, 200);
      }

      function replayGame() {
        if (currentGameId) {
          const replayUrl = `https://backgammon-go.onelink.me/4n1X?bg_type=report&bg_platform=fairness_verifier&bg_match=${currentGameId}`;
          window.open(replayUrl, "_blank");
        }
      }

      async function shareVerification() {
        const shareUrl = window.location.href;
        const shareTitle = "Backgammon Game Verification";
        const shareText = `I've verified the fairness of my backgammon game #${currentGameId}. All dice rolls were cryptographically proven to be fair!`;

        // Check if on mobile device
        const isMobile =
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          );

        // Try native share only on mobile devices
        if (isMobile && navigator.share) {
          try {
            await navigator.share({
              title: shareTitle,
              text: shareText,
              url: shareUrl,
            });
            return; // Success - don't show custom modal
          } catch (err) {
            // User cancelled or error occurred
            if (err.name === "AbortError") {
              // User cancelled, don't show modal
              return;
            }
            // Other error, fall through to show custom modal
            console.log("Native share failed:", err);
          }
        }

        // Show manual share options for desktop or if native share failed
        shareModal.classList.add("show");
      }

      function handleShare(platform) {
        const shareUrl = encodeURIComponent(window.location.href);
        const shareText = encodeURIComponent(
          `I've verified the fairness of my backgammon game #${currentGameId}. All dice rolls were cryptographically proven to be fair!`
        );
        let targetUrl = "";

        switch (platform) {
          case "twitter":
            targetUrl = `https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}`;
            break;
          case "facebook":
            targetUrl = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
            break;
          case "whatsapp":
            targetUrl = `https://wa.me/?text=${shareText}%20${shareUrl}`;
            break;
          case "telegram":
            targetUrl = `https://t.me/share/url?url=${shareUrl}&text=${shareText}`;
            break;
          case "reddit":
            targetUrl = `https://reddit.com/submit?url=${shareUrl}&title=${shareText}`;
            break;
          case "copy":
            navigator.clipboard.writeText(window.location.href).then(() => {
              alert("Link copied to clipboard!");
            });
            shareModal.classList.remove("show");
            return;
        }

        if (targetUrl) {
          window.open(targetUrl, "_blank");
          shareModal.classList.remove("show");
        }
      }

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      function maybeAutoVerify() {
        const p = new URLSearchParams(window.location.search);
        if (!p.has("report")) return;

        try {
          const b64 = decodeURIComponent(p.get("report"))
            .replace(/-/g, "+")
            .replace(/_/g, "/");
          const decoded = atob(b64);
          const text = new TextDecoder().decode(
            Uint8Array.from(decoded, (c) => c.charCodeAt(0))
          );
          handleFileContent(text);

          setTimeout(() => {
            if (wasmReady) {
              startVerification();
            } else {
              const checkReady = setInterval(() => {
                if (wasmReady) {
                  clearInterval(checkReady);
                  startVerification();
                }
              }, 100);
            }
          }, 500);
        } catch (e) {
          console.error("Failed to decode report param:", e);
        }
      }

      // Make functions globally accessible
      window.replayGame = replayGame;
      window.shareVerification = shareVerification;
    </script>
  </body>
</html>
